/*
 * Copyright (c) 2014-2025 GraphDefined GmbH <achim.friedland@graphdefined.com>
 * This file is part of WWCP OCPP <https://github.com/OpenChargingCloud/WWCP_OCPP>
 *
 * Licensed under the Affero GPL license, Version 3.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.gnu.org/licenses/agpl.html
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#region Usings

using org.GraphDefined.Vanaheimr.Illias;
using org.GraphDefined.Vanaheimr.Hermod.HTTP;

using cloud.charging.open.protocols.WWCP;

using cloud.charging.open.protocols.OCPP;
using cloud.charging.open.protocols.OCPPv2_1.VulnerabilityManagement;
using org.GraphDefined.Vanaheimr.Hermod.Mail;

#endregion

namespace cloud.charging.open.protocols.OCPPv2_1
{

    /// <summary>
    /// Logical Component responsible for vulnerability management.
    /// </summary>
    public class VulnerabilityManagementCtrlr : ALogicalComponentConfig
    {

        #region Properties

        /// <summary>
        /// Deep-links to the JSON document with detailed vulnerability management information for exactly this device.
        /// </summary>
        public IEnumerable<URL>                 JSONDocument                        { get; set; }


        /// <summary>
        /// The current lifecycle phase of the device.
        /// </summary>
        public LifecyclePhase                   LifecyclePhase                      { get; set; }

        /// <summary>
        /// The support period of the device, e.g. “June 2030”.
        /// </summary>
        public String                           SupportPeriod                       { get; set; }

        /// <summary>
        /// Deep-links to the technical documentation of the device.
        /// </summary>
        public IEnumerable<URL>                 TechnicalDocumentation              { get; set; }


        /// <summary>
        /// 
        /// </summary>
        public String?                          RiskAssessment                      { get; set; }

        /// <summary>
        /// An enumeration of supported use cases.
        /// </summary>
        public IEnumerable<UseCase>             SupportedUseCases                   { get; set; }

        /// <summary>
        /// Legal and standards compliance information.
        /// </summary>
        public IEnumerable<Compliance>          Compliance                          { get; set; }

        /// <summary>
        /// Deep-Links to legal and standards compliance certificates.
        /// </summary>
        public IEnumerable<URL>                 ComplianceCertificates              { get; set; }



        /// <summary>
        /// Deep-links to the security policy for exactly this device.
        /// </summary>
        public IEnumerable<URL>                 SecurityPolicy                      { get; set; }

        /// <summary>
        /// Deep-links to a web page with firmware updates for exactly this device.
        /// </summary>
        public IEnumerable<URL>                 FirmwareUpdates                     { get; set; }

        /// <summary>
        /// Deep-links to known vulnerabilities for exactly this device/firmware.
        /// </summary>
        public IEnumerable<URL>                 KnownVulnerabilities                { get; set; }

        /// <summary>
        /// Deep-links to a vulnerability reporting mechanism for exactly this device.
        /// </summary>
        public IEnumerable<URL>                 VulnerabilityReportingWWW           { get; set; }

        /// <summary>
        /// An enumeration of e-mail addresses for vulnerability reporting for exactly this device.
        /// </summary>
        public IEnumerable<SimpleEMailAddress>  VulnerabilityReportingEMail         { get; set; }

        /// <summary>
        /// An optional OpenPGP key to be used for vulnerability reporting (RFC 4880 or RFC 9580).
        /// </summary>
        public String?                          VulnerabilityReportingOpenPGPKey    { get; set; }


        // 3.2.19. Controller (An embedded logic controller)
        // Manufacturer                         Controller manufacturer name
        // Model                                Controller model name
        // ECVariant                            Engineering Change variant
        // SerialNumber                         Controller hardware serial number
        // VersionNumber                        Hardware version number
        // VersionDate                          Hardware version date
        // FirmwareVersion                      Firmware version number (as reported in BootNotification)


        /// <summary>
        /// Deep-links to the hardware bill of materials for exactly this device revision.
        /// </summary>
        public IEnumerable<URL>                 HBOM                                { get; set; }//URL?sha256="0xABC123..."

        /// <summary>
        /// Deep-links to the software bill of materials for exactly this device and firmware version.
        /// </summary>
        public IEnumerable<URL>                 SBOM                                { get; set; }//URL?sha256="0xABC123..."




        /// <summary>
        /// 
        /// </summary>
        public String?                          LegalReporting                      { get; set; }

        /// <summary>
        /// 
        /// </summary>
        public String?                          Monitoring                          { get; set; }


        // components (list)

        #endregion

        #region Constructor(s)

        /// <summary>
        /// Create a new vulnerability management controller.
        /// </summary>
        /// <param name="LifecyclePhase">xxx</param>
        /// 
        /// 
        /// <param name="Instance">The optional case insensitive name of the instance in case the component exists as multiple instances.</param>
        /// <param name="CustomData">An optional custom data object allowing to store any kind of customer specific data.</param>
        public VulnerabilityManagementCtrlr(LifecyclePhase             LifecyclePhase,
                                            String                     SupportPeriod,
                                            IEnumerable<UseCase>       SupportedUseCases,
                                            IEnumerable<TxStopPoint>   TxStopPoint,

                                            IEnumerable<URL>?          TechnicalDocumentation    = null,
                                            Boolean?                   StopTxOnInvalidId         = null,
                                            WattHour?                  MaxEnergyOnInvalidId      = null,

                                            String?                    Instance                  = null,
                                            CustomData?                CustomData                = null)

            : base(nameof(VulnerabilityManagementCtrlr),
                   Instance,
                   I18NString.Create("Logical Component responsible for vulnerability management."),
                   CustomData)

        {

            this.LifecyclePhase      = LifecyclePhase;


            #region LifecyclePhase

            variableConfigs.Add(
                new VariableConfig(

                    Name:             "LifecyclePhase",
                    ValueGetter:      LifecyclePhase.ToString,

                    Attributes:       new VariableAttribute(
                                          Mutability:  MutabilityTypes.ReadWrite
                                      ),

                    Characteristics:  new VariableCharacteristics(
                                          DataType:    DataTypes.String
                                      ),

                    Description:      I18NString.Create(
                                          "Lifecycle Phase"
                                      )

                )
            );

            #endregion

            //#region TxBeforeAcceptedEnabled

            //variableConfigs.Add(
            //    new VariableConfig(

            //        Name:             "TxBeforeAcceptedEnabled",
            //        ValueGetter:      () => this.TxBeforeAcceptedEnabled.HasValue
            //                                    ? this.TxBeforeAcceptedEnabled.Value
            //                                          ? "true"
            //                                          : "false"
            //                                    : null,

            //        Attributes:       new VariableAttribute(
            //                              Mutability:  MutabilityTypes.ReadWrite
            //                          ),

            //        Characteristics:  new VariableCharacteristics(
            //                              DataType:    DataTypes.Boolean
            //                          ),

            //        Description:      I18NString.Create(
            //                              "With this configuration variable the Charging Station can be configured to allow charging before " +
            //                              "having received a BootNotificationResponse with RegistrationStatus: Accepted. " +
            //                              "See: Transactions before being accepted by a CSMS."
            //                          )

            //    )
            //);

            //#endregion

            //#region TxStartPoint

            //variableConfigs.Add(
            //    new VariableConfig(

            //        Name:             "TxStartPoint",
            //        ValueGetter:      () => this.TxStartPoint.Any()
            //                                    ? this.TxStartPoint.AggregateWith(',')
            //                                    : null,

            //        Attributes:       new VariableAttribute(
            //                              Mutability:  MutabilityTypes.ReadWrite
            //                          ),

            //        Characteristics:  new VariableCharacteristics(
            //                              DataType:    DataTypes.MemberList
            //                          ),

            //        Description:      I18NString.Create("Defines when the Charging Station starts a new transaction: first transactioneventRequest: eventType = Started. When any event in the given list occurs, the Charging Station SHALL start a transaction The Charging Station SHALL only send the Started event once for every transaction. It is advised to put all events that should be part of a transaction in the list, in case the start event never occurs. Because the possible events don’t always have to come in the same order it is possible to provide a list of events. Which ever comes first will then cause a transaction to be started. For example: EVConnected, Authorized would mean that a transaction is started when an EV is detected (Cable is connected), or when an EV Driver swipes his RFID card and the CSMS successfully authorizes the ID for charging.")

            //    )
            //);

            //#endregion

            //#region TxStopPoint

            //variableConfigs.Add(
            //    new VariableConfig(

            //        Name:             "TxStopPoint",
            //        ValueGetter:      () => this.TxStopPoint.Any()
            //                                    ? this.TxStopPoint.AggregateWith(',')
            //                                    : null,

            //        Attributes:       new VariableAttribute(
            //                              Mutability:  MutabilityTypes.ReadWrite
            //                          ),

            //        Characteristics:  new VariableCharacteristics(
            //                              DataType:    DataTypes.MemberList
            //                          ),

            //        Description:      I18NString.Create("Defines when the Charging Station ends a transaction: last transactioneventRequest: eventType = Ended. When any event in the given list is no longer valid, the Charging Station SHALL end the transaction. The Charging Station SHALL only send the Ended event once for every transaction. MaxEnergyOnInvalidId integer Maximum amount of energy in Wh delivered when an identifier is deauthorized by the CSMS after start of a transaction.")

            //    )
            //);

            //#endregion

            //#region StopTxOnInvalidId

            //variableConfigs.Add(
            //    new VariableConfig(

            //        Name:             "StopTxOnInvalidId",
            //        ValueGetter:      () => this.StopTxOnInvalidId.HasValue
            //                                    ? this.StopTxOnInvalidId.Value
            //                                          ? "true"
            //                                          : "false"
            //                                    : null,

            //        Attributes:       new VariableAttribute(
            //                              Mutability:  MutabilityTypes.ReadWrite
            //                          ),

            //        Characteristics:  new VariableCharacteristics(
            //                              DataType:    DataTypes.Boolean
            //                          ),

            //        Description:      I18NString.Create("Whether the Charging Station will stop an ongoing transaction when it receives a non-accepted authorization status in TransactionEventResponse for this transaction.")

            //    )
            //);

            //#endregion

            //#region StopTxOnEVSideDisconnect

            //variableConfigs.Add(
            //    new VariableConfig(

            //        Name:             "StopTxOnEVSideDisconnect",
            //        ValueGetter:      () => this.StopTxOnEVSideDisconnect
            //                                    ? "true"
            //                                    : "false",

            //        Attributes:       new VariableAttribute(
            //                              Mutability:  MutabilityTypes.ReadWrite
            //                          ),

            //        Characteristics:  new VariableCharacteristics(
            //                              DataType:    DataTypes.Boolean
            //                          ),

            //        Description:      I18NString.Create("When set to true, the Charging Station SHALL administratively stop the transaction when the cable is unplugged from the EV.")

            //    )
            //);

            //#endregion

            //#region MaxEnergyOnInvalidId

            //variableConfigs.Add(
            //    new VariableConfig(

            //        Name:             "MaxEnergyOnInvalidId",
            //        ValueGetter:      () => this.MaxEnergyOnInvalidId.HasValue
            //                                    ? ((UInt32) Math.Round(this.MaxEnergyOnInvalidId.Value.Value)).ToString()
            //                                    : null,

            //        Attributes:       new VariableAttribute(
            //                              Mutability:  MutabilityTypes.ReadWrite
            //                          ),

            //        Characteristics:  new VariableCharacteristics(
            //                              Unit:        UnitsOfMeasure.Wh(),
            //                              DataType:    DataTypes.Integer
            //                          ),

            //        Description:      I18NString.Create("Maximum amount of energy in Wh delivered when an identifier is deauthorized by the CSMS after start of a transaction.")

            //    )
            //);

            //#endregion


        }

        #endregion


    }

}
